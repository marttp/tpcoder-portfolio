---
import type { CollectionEntry } from 'astro:content';
import BaseHead from '../components/header/BaseHead.astro';
import Header from '../components/header/Header.astro';
import Footer from '../components/Footer';
import FormattedDate from '../components/FormattedDate.astro';

type Props = CollectionEntry<'blog'>['data'];

const { title, description, pubDate, updatedDate, heroImage, language, translationSlug } = Astro.props;

const translationLabel = language === 'en' ? 'à¸­à¹ˆà¸²à¸™à¹€à¸›à¹‡à¸™à¸ à¸²à¸©à¸²à¹„à¸—à¸¢' : 'Read in English';
const translationFlag = language === 'en' ? 'ðŸ‡¹ðŸ‡­' : 'ðŸ‡ºðŸ‡¸';
---

<html lang="en">
  <head>
    <BaseHead title={title} description={description} image={heroImage} />
  </head>

  <body class="bg-background dark:bg-background-dark">
    <!-- Mermaid Diagram Support -->
    <script type="module">
      import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

      // Initialize mermaid with consistent light purple theme
      mermaid.initialize({
        startOnLoad: true,
        theme: 'base',
        themeVariables: {
          // Light purple/lavender color scheme
          primaryColor: '#e0e7ff',
          primaryTextColor: '#0f172a',
          primaryBorderColor: '#a5b4fc',
          lineColor: '#334155',
          secondaryColor: '#c7d2fe',
          tertiaryColor: '#eef2ff',
          background: '#f8fafc',
          mainBkg: '#e0e7ff',
          nodeBorder: '#818cf8',
          clusterBkg: '#eef2ff',
          titleColor: '#0f172a',
          edgeLabelBackground: '#f1f5f9',
          // Text colors - darker for better readability
          textColor: '#0f172a',
          nodeTextColor: '#0f172a',
          // Edge label text
          edgeLabelTextColor: '#0f172a',
        }
      });

      // Expose mermaid to window for manual rendering (e.g., in ContentTabs)
      window.mermaid = mermaid;
    </script>
    <Header />
    <main class="max-w-4xl mx-auto px-4 md:px-8 py-8">
      <article>
        <!-- Hero Image -->
        {heroImage && (
          <div class="mb-8">
            <img
              src={heroImage}
              alt={title}
              class="w-full h-auto max-h-96 object-cover rounded-lg shadow-lg"
            />
          </div>
        )}

        <!-- Article Header -->
        <header class="mb-8">
          <h1 class="text-3xl md:text-4xl font-bold text-black dark:text-white mb-4">
            {title}
          </h1>
          <div class="flex flex-wrap gap-4 text-sm text-black dark:text-primary-light">
            {pubDate && (
              <div class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z" />
                </svg>
                <span>Published on <FormattedDate date={pubDate} /></span>
              </div>
            )}
            {updatedDate && (
              <div class="flex items-center gap-1">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
                <span>Updated on <FormattedDate date={updatedDate} /></span>
              </div>
            )}
          </div>
          {translationSlug && (
            <div class="mt-4">
              <a
                href={`/blog/${translationSlug}/`}
                class="inline-flex items-center gap-2 px-4 py-2 rounded-lg border border-gray-300 dark:border-gray-600 bg-gray-50 dark:bg-gray-800 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors"
              >
                <span>{translationFlag}</span>
                <span>{translationLabel}</span>
              </a>
            </div>
          )}
        </header>

        <hr class="border-gray-200 dark:border-gray-700 mb-8" />

        <!-- Article Content with Prose Styling -->
        <div class="prose prose-lg max-w-none
          prose-headings:text-black dark:prose-headings:text-white
          prose-headings:font-semibold
          prose-h2:text-2xl prose-h2:mt-10 prose-h2:mb-4
          prose-h3:text-xl prose-h3:mt-8 prose-h3:mb-3
          prose-h4:text-lg prose-h4:mt-6 prose-h4:mb-2
          prose-p:text-black dark:prose-p:text-gray-300
          prose-p:leading-relaxed prose-p:mb-4
          prose-a:text-primary-dark dark:prose-a:text-primary-light
          prose-a:no-underline hover:prose-a:underline
          prose-strong:text-black dark:prose-strong:text-white
          prose-ul:my-4 prose-ul:list-disc prose-ul:pl-6
          prose-ol:my-4 prose-ol:list-decimal prose-ol:pl-6
          prose-li:text-black dark:prose-li:text-gray-300
          prose-li:mb-2
          prose-blockquote:border-l-4 prose-blockquote:border-primary-light
          prose-blockquote:pl-4 prose-blockquote:italic
          prose-blockquote:text-black/80 dark:prose-blockquote:text-gray-400
          prose-code:bg-gray-100 dark:prose-code:bg-gray-800
          prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded
          prose-code:text-sm prose-code:text-pink-600 dark:prose-code:text-pink-400
          prose-pre:bg-gray-900 prose-pre:text-gray-100
          prose-pre:rounded-lg prose-pre:p-4 prose-pre:overflow-x-auto
          [&_pre_code]:bg-transparent [&_pre_code]:p-0
          dark:[&_pre_code]:bg-transparent
          prose-img:rounded-lg prose-img:shadow-md
          prose-hr:border-gray-200 dark:prose-hr:border-gray-700
        ">
          <slot />
        </div>

        <!-- Back to Blog Link -->
        <div class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700">
          <a
            href="/blog/"
            class="inline-flex items-center gap-2 text-primary-dark dark:text-primary-light hover:underline"
          >
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18" />
            </svg>
            Back to all posts
          </a>
        </div>
      </article>
    </main>
    <Footer />
  </body>
</html>
